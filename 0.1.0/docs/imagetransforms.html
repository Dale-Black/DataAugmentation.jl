<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Publish.jl" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="" />
    <title>DataAugmentation.jl</title>
    <link rel="stylesheet" href="..&#x2F;normalize.css" />
    <link rel="stylesheet" href="..&#x2F;tabulator_simple.min.css" />
    <link rel="stylesheet" href="..&#x2F;lorenzo.css" />
    <script src="..&#x2F;versions.js"></script>
    <script src="..&#x2F;lunr.js"></script>
    <script src="..&#x2F;highlight.min.js"></script>
    <script src="..&#x2F;tabulator.min.js"></script>
    <script src="..&#x2F;julia.min.js"></script>
    <script src="..&#x2F;julia-repl.min.js"></script>
    <script src="..&#x2F;publish.js"></script>
    

    <!-- 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
        -->

</head>
<body>
    <div class="menu">
        <svg id="menu-toggler" title="Contents" onclick="toggleIndexPage();" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor" /><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor" /><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor" /></svg>
        <input id="search-input" placeholder="Search">
        <select id="version-selector"></select>
    </div>
    <main id="page"><article><h1 id="spatial-transformations"><a href="#spatial-transformations" class="anchor"></a>Spatial transformations</h1>
<p>DataAugmentation.jl comes with various spatial transformations that you
can apply to your data. You can apply them to <a href="../docstrings/DataAugmentation.Image.html"><code>Image</code></a>s and
the keypoint-based items <a href="../docstrings/DataAugmentation.Keypoints.html"><code>Keypoints</code></a>, <a href="../docstrings/DataAugmentation.Polygon.html"><code>Polygon</code></a>, and <a href="../docstrings/DataAugmentation.BoundingBox.html"><code>BoundingBox</code></a>.</p>
<p>Let’s take this picture of a light house:</p>
<pre><code output="false" style="display:none;" cell="main" result="false" class="language-julia">using DataAugmentation
using MosaicViews
using Images
using TestImages
using StaticArrays

imagedata = testimage(&quot;lighthouse&quot;)
imagedata = imresize(imagedata, ratio = 196 / size(imagedata, 1))
</code></pre>
<pre><code class="language-julia">imagedata = testimage(&quot;lighthouse&quot;)
</code></pre>
<pre><code style="display:none;" cell="main" class="language-julia">imagedata
</code></pre>
<img src="12457559648018087023.png" alt="" /><p>To apply a transformation <code>tfm</code> to it, wrap it in
<code>Image</code>, apply the transformation and unwrap it using <a href="../docstrings/DataAugmentation.itemdata.html"><code>itemdata</code></a>:</p>
<pre><code cell="main" class="language-julia">tfm = Crop((196, 196))
image = Image(imagedata)
apply(tfm, image) |&gt; itemdata
</code></pre>
<img src="15407628329779533762.png" alt="" /><p>Now let’s say we want to train a light house detector and have a bounding box
for the light house. We can use the <a href="../docstrings/DataAugmentation.BoundingBox.html"><code>BoundingBox</code></a> item to represent it.
It takes the two corners of the bounding rectangle as the first argument. As
the second argument we have to pass the size of the corresponding image.</p>
<pre><code cell="main" class="language-julia">points = SVector{2, Float32}[SVector(23., 120.), SVector(120., 150.)]
bbox = BoundingBox(points, size(imagedata))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">BoundingBox{2, Float32}()</code></pre>
<p><a href="../docstrings/DataAugmentation.showitem.html"><code>showitem</code></a> visualizes the two items:</p>
<pre><code cell="main" class="language-julia">showitem((image, bbox))
</code></pre>
<img src="15521685093106770844.png" alt="" /><p>If we apply transformations like translation and cropping
to the image, then the same transformations have to be applied to the bounding
box. Otherwise, the bounding box will no longer match up with the light house.</p>
<p>Another problem can occur with stochastic transformations like <a href="../docstrings/DataAugmentation.RandomResizeCrop.html"><code>RandomResizeCrop</code></a>.
If we apply it separately to the image and the bounding box, they will be cropped from
slightly different locations:</p>
<pre><code cell="main" class="language-julia">tfm = RandomResizeCrop((128, 128))
showitem((
    apply(tfm, image),
    apply(tfm, bbox)
))
</code></pre>
<img src="10843302937239836193.png" alt="" /><p>Instead, pass a tuple of the items to a single <code>apply</code> call so the same
random state will be used for both image and bounding box:</p>
<pre><code cell="main" class="language-julia">apply(tfm, (image, bbox)) |&gt; showitem
</code></pre>
<img src="4689432190710862700.png" alt="" /><h2 id="gallery"><a href="#gallery" class="anchor"></a>Gallery</h2>
<pre><code style="display:none;" cell="main" result="false" class="language-julia">function showtransform(tfm, item, n = 8; ncol = 4)
    return mosaicview(
        [showitem(apply(tfm, item)) for _ in 1:n],
        fillvalue = RGBA(1, 1, 1, 0),
        npad = 8,
        rowmajor = true,
        ncol = ncol)
end

function showtransforms(tfms, item; ncol = length(tfms))
    return mosaicview(
        [showitem(apply(tfm, item)) for tfm in tfms],
        fillvalue = RGBA(1, 1, 1, 0),
        npad = 8,
        rowmajor = true,
        ncol = ncol)
end
</code></pre>
<h3 id="randomresizecropsz"><a href="#randomresizecropsz" class="anchor"></a><a href="../docstrings/DataAugmentation.RandomResizeCrop.html"><code>RandomResizeCrop</code></a><code>(sz)</code></h3>
<p>Resizes the sides so that one of them is no longer than <code>sz</code> and
crops a region of size <code>sz</code> <em>from a random location</em>.</p>
<pre><code cell="main" result="false" class="language-julia">tfm = RandomResizeCrop((128, 128))
</code></pre>
<pre><code style="display:none;" cell="main" class="language-julia">o = showtransform(tfm, (image, bbox), 6, ncol=6)
</code></pre>
<img src="744962662657939908.png" alt="" /><h3 id="centerresizecrop"><a href="#centerresizecrop" class="anchor"></a><a href="../docstrings/DataAugmentation.CenterResizeCrop.html"><code>CenterResizeCrop</code></a></h3>
<p>Resizes the sides so that one of them is no longer than <code>sz</code> and
crops a region of size <code>sz</code> <em>from the center</em>.</p>
<pre><code cell="main" result="false" class="language-julia">tfm = CenterResizeCrop((128, 128))
</code></pre>
<pre><code style="display:none;" cell="main" class="language-julia">o = showtransform(tfm, (image, bbox), 1)
</code></pre>
<img src="1845973879612368985.png" alt="" /><h3 id="cropsz-from"><a href="#cropsz-from" class="anchor"></a><a href="../docstrings/DataAugmentation.Crop.html"><code>Crop</code></a><code>(sz[, from])</code></h3>
<p>Crops a region of size <code>sz</code> from the image, <em>without resizing</em> the image first.</p>
<pre><code cell="main" result="false" class="language-julia">using DataAugmentation: FromOrigin, FromCenter, FromRandom
tfms = [
    Crop((128, 128), FromOrigin()),
    Crop((128, 128), FromCenter()),
    Crop((128, 128), FromRandom()),
    Crop((128, 128), FromRandom()),
    Crop((128, 128), FromRandom()),
    Crop((128, 128), FromRandom()),
]
</code></pre>
<pre><code style="display:none;" cell="main" class="language-julia">o = showtransforms(tfms, (image, bbox))
</code></pre>
<img src="6957758172823111195.png" alt="" /></article>
        <div id="page-navigation">
            <a id="previous-page" title="Previous" href="items.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.2426 6.34317L14.8284 4.92896L7.75739 12L14.8285 19.0711L16.2427 17.6569L10.5858 12L16.2426 6.34317Z" fill="currentColor" /></svg></a>
            <a id="next-page" title="Next" href="..&#x2F;docstrings.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5858 6.34317L12 4.92896L19.0711 12L12 19.0711L10.5858 17.6569L16.2427 12L10.5858 6.34317Z" fill="currentColor" /></svg></a>
        </div>
    </main>
    <nav id="toc"><ul>
<li><a href="../README.html">README</a></li>
<li><a href="../docs/quickstart.html">Quickstart</a></li>
<li><a href="../docs/overview.html">Overview</a></li>
<li><a href="../docs/items.html">Items</a></li>
<li><a href="../docs/imagetransforms.html">Image transformations</a></li>
<li><a href="../docstrings.html">Docstrings</a></li>
</ul>
</nav>
    <footer>
        Built with <a target="_blank" href="https://github.com/MichaelHatherly/Publish.jl">Publish.jl</a> and the <a target="_blank" href="https://julialang.org">Julia Language.</a>
    </footer>
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
